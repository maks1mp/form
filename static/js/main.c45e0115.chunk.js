(this["webpackJsonpdynamic-form"]=this["webpackJsonpdynamic-form"]||[]).push([[0],{315:function(e,t,n){"use strict";n.r(t);var r,a,c=n(0),i=n.n(c),s=n(20),u=n.n(s),l=n(62),o=n.n(l),d=n(8),b=n(38),j=n(10),f=n.n(j),O=n(9),m=n(14);!function(e){e.product="product",e.serialNumber="serialNumber",e.date="date",e.file="file",e.textInput="textInput",e.email="email",e.country="country",e.state="state",e.phone="phone",e.dropdown="dropdown",e.checkboxes="checkboxes"}(r||(r={})),function(e){e.product="product",e.customer="customer",e.all="all"}(a||(a={}));var p=n(12),h=n(139),v=n.n(h),x=n(16),g=n(2),y=function(e){var t=e.name,n=e.id,r=e.values,a=e.disabled;return Object(g.jsxs)(x.b,{as:"select",name:t,id:n,disabled:a,children:[Object(g.jsx)("option",{}),r.map((function(e){return Object(g.jsx)("option",{value:e.value,label:e.label,children:e.label},e.id)}))]})},S=function(e){var t=e.name,n=e.values,r=e.id,a=e.disabled;return Object(g.jsx)("div",{role:"group",id:r,children:n.map((function(e){return Object(g.jsxs)("label",{children:[Object(g.jsx)("span",{children:e.label}),Object(g.jsx)(x.b,{type:"radio",id:e.id,name:t,value:e.value,disabled:a})]},e.id)}))})},w=function(e){var t=e.id,n=e.label,r=e.field,a=e.form,i=e.disabled,s=Object(c.useState)(""),u=Object(O.a)(s,2),l=u[0],o=u[1],b=Object(c.useState)([]),j=Object(O.a)(b,2),h=j[0],v=j[1],x=Object(c.useCallback)(function(){var e=Object(m.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){console.log("Fake api call..."),setTimeout((function(){Math.random()<.5?e(Object(d.a)(Object(d.a)({},t),{},{valid:!0,validating:!1})):e(Object(d.a)(Object(d.a)({},t),{},{valid:!1,validating:!1}))}),2e3)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),y=Object(c.useCallback)(Object(m.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l&&!h.some((function(e){return e.value===l}))){e.next=2;break}return e.abrupt("return");case 2:return t={value:l,valid:!1,validating:!0},v((function(e){return[].concat(Object(p.a)(e),[t])})),o(""),e.next=7,x(t);case 7:n=e.sent,v((function(e){return e.map((function(e){return e.value===n.value?n:e}))}));case 9:case"end":return e.stop()}}),e)}))),[l,h,x]);return Object(c.useEffect)((function(){var e=h.filter((function(e){return e.valid&&!e.validating}));a.setFieldValue(r.name,e.length>0?e.map((function(e){return e.value})):[])}),[r.name,h]),Object(g.jsxs)("div",{children:[h.length>0&&Object(g.jsx)("ul",{children:h.map((function(e){return Object(g.jsxs)("li",{children:[e.value," ",e.validating?"Checking...":e.valid?"OK":"FAILURE"," ",Object(g.jsx)("button",{onClick:function(){v((function(t){return t.filter((function(t){return t.value!==e.value}))}))},children:"Remove"})]},e.value)}))}),Object(g.jsxs)("label",{children:[Object(g.jsx)("span",{children:n}),Object(g.jsx)("input",{disabled:i||h.some((function(e){return e.validating})),type:"text",onKeyDown:function(e){e&&"Enter"===e.key&&y()},onBlur:y,onChange:function(e){return o(e.target.value)},value:l,id:t})]})]})},k=n(135),C=null,F=function(e){var t=e.country,n=e.field,r=e.form,a=e.disabled,i=Object(c.useState)([]),s=Object(O.a)(i,2),u=s[0],l=s[1];function o(){return(o=Object(m.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C){e.next=11;break}return C={},e.next=4,fetch("states.json",{cache:"force-cache"});case 4:return r=e.sent,e.next=7,r.json();case 7:n=e.sent,C=n,e.next=12;break;case 11:n=C;case 12:return t&&t in n&&l(Object.entries(n[t]).map((function(e){var t=Object(O.a)(e,2);return{value:t[0],label:t[1]}}))),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(c.useEffect)((function(){!function(e){o.apply(this,arguments)}(t)}),[r,n,t]),Object(g.jsx)(k.a,{options:u,name:n.name,value:n.value,onChange:function(e){r.setFieldValue(n.name,e)},isDisabled:Boolean(a)})},D=Object(c.memo)(F),q=n(74),N=null,A=function(e){var t=e.field,n=e.form,r=e.disabled;return Object(g.jsx)(q.a,{cacheOptions:!0,defaultOptions:!0,name:t.name,defaultValue:t.value,isDisabled:r,onChange:function(e){n.setFieldValue("state",""),n.setFieldValue(t.name,e.value)},loadOptions:function(){var e=Object(m.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=10;break}return e.next=3,fetch("countries.json",{cache:"force-cache"});case 3:return r=e.sent,e.next=6,r.json();case 6:N=e.sent,n=N,e.next=11;break;case 10:n=N;case 11:return e.abrupt("return",Object.entries(n).filter((function(e){var n=Object(O.a)(e,2);n[0];return n[1].toLowerCase().includes(t.toLowerCase())})).map((function(e){var t=Object(O.a)(e,2);return{value:t[0],label:t[1]}})));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})},E=Object(c.memo)(A),I=n(53),L=n(27);function B(e){return e.reduce((function(e,t){return Object(d.a)(Object(d.a)({},e),{},Object(I.a)({},t.name,t.default||""))}),{})}function P(e){var t=e.reduce((function(e,t){var n=L.b((function(e){return t.type===r.serialNumber&&t.required?L.a().of(L.e()).required("".concat(t.label," is a required field")).min(1).ensure():t.type===r.product&&t.required?L.d().required("".concat(t.label," is a required field")).nullable():t.type===r.email&&t.required?L.e().email("Invalid email").required("".concat(t.label," is a required field")):t.required?L.e().required("".concat(t.label," is a required field")):L.c()}));return Object(d.a)(Object(d.a)({},e),{},Object(I.a)({},t.name,n))}),{});return L.d().shape(t)}n(271);var T=function(e){var t=e.fields,n=e.handleSubmit,a=e.children,c=function(e){return Object(g.jsxs)(g.Fragment,{children:[e.description&&Object(g.jsx)("div",{children:e.description}),Object(g.jsx)(x.a,{name:e.name})]})};return Object(g.jsx)(x.d,{initialValues:B(t),validationSchema:P(t),onSubmit:function(){var e=Object(m.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.resetForm,e.prev=1,e.next=4,n(t);case 4:return e.prev=4,a(t),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})));return function(t,n){return e.apply(this,arguments)}}(),children:function(e){return Object(g.jsxs)(x.c,{style:{marginBottom:30,marginTop:30},onSubmit:e.handleSubmit,children:[Object(g.jsx)(g.Fragment,{children:t.map((function(t){var n=[t.id,t.name,t.label].join("");switch(t.type){case r.textInput:case r.phone:case r.email:return Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{children:Object(g.jsxs)("label",{children:[Object(g.jsx)("span",{children:t.label}),Object(g.jsx)(x.b,{name:t.name,disabled:e.isSubmitting})]})}),c(t)]},n);case r.serialNumber:return Object(g.jsxs)("div",{children:[Object(g.jsx)(x.b,Object(d.a)({render:function(n){return Object(g.jsx)(w,Object(d.a)(Object(d.a)(Object(d.a)({},n),t),{},{disabled:e.isSubmitting}))}},t)),c(t)]},n);case r.file:return Object(g.jsxs)("div",{children:[Object(g.jsx)("label",{children:t.label}),Object(g.jsx)("div",{children:Object(g.jsx)("input",{disabled:e.isSubmitting,accept:t.accept,type:t.type,name:t.name,onChange:function(n){var r,a;e.setFieldValue(t.name,null===n||void 0===n||null===(r=n.target)||void 0===r||null===(a=r.files)||void 0===a?void 0:a[0])}})}),c(t)]},n);case r.checkboxes:var a=t.options,i=Object(b.a)(t,["options"]);return Object(g.jsxs)("div",{children:[Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{children:t.label}),Object(g.jsx)(S,Object(d.a)(Object(d.a)({disabled:e.isSubmitting},i),{},{values:a}))]}),c(t)]},n);case r.dropdown:var s=t.options,u=Object(b.a)(t,["options"]);return Object(g.jsxs)("div",{children:[Object(g.jsxs)("label",{children:[Object(g.jsx)("span",{children:t.label}),Object(g.jsx)(y,Object(d.a)(Object(d.a)({},u),{},{values:s,disabled:e.isSubmitting}))]}),c(t)]},n);case r.date:var l=e.values[t.name];return Object(g.jsxs)("div",{children:[Object(g.jsx)("label",{htmlFor:t.id,children:Object(g.jsx)("span",{children:t.label})}),Object(g.jsx)(v.a,{id:t.id,disabled:e.isSubmitting,required:t.required,selected:l?new Date(l):null,dateFormat:"MMMM d, yyyy",onBlur:e.handleBlur,name:t.name,onChange:function(n){n&&e.setFieldValue(t.name,n.toString())}}),c(t)]},n);case r.product:return Object(g.jsxs)("div",{children:[Object(g.jsxs)("label",{children:[Object(g.jsx)("span",{children:t.label}),Object(g.jsx)(x.b,Object(d.a)(Object(d.a)({disabled:e.isSubmitting},t),{},{render:function(t){var n=t.field,r=t.form;return Object(g.jsx)(q.a,{cacheOptions:!0,formatOptionLabel:function(e){var t;return Object(g.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(g.jsx)("img",{width:32,src:null===e||void 0===e||null===(t=e.image)||void 0===t?void 0:t.src,alt:""}),Object(g.jsx)("span",{children:null===e||void 0===e?void 0:e.title})]})},isClearable:!0,isDisabled:e.isSubmitting,defaultOptions:!0,name:n.name,value:n.value||"",isOptionSelected:function(e,t){return t.some((function(t){return t.variantId===e.variantId}))},onChange:function(e){return r.setFieldValue(n.name,e)},loadOptions:function(){var e=Object(m.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("search.json?q=".concat(t));case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})}}))]}),c(t)]},n);case r.country:return Object(g.jsxs)("div",{children:[Object(g.jsxs)("label",{children:[Object(g.jsx)("span",{children:t.label}),Object(g.jsx)(x.b,Object(d.a)(Object(d.a)({},t),{},{disabled:e.isSubmitting,render:function(t){return Object(g.jsx)(E,Object(d.a)(Object(d.a)({},t),{},{disabled:e.isSubmitting}))}}))]}),c(t)]},n);case r.state:var o,j,O=null!==(o=null===(j=e.values)||void 0===j?void 0:j.country)&&void 0!==o?o:"";return Object(g.jsxs)("div",{children:[Object(g.jsxs)("label",{children:[Object(g.jsx)("span",{children:t.label}),Object(g.jsx)(x.b,Object(d.a)(Object(d.a)({},t),{},{country:O,render:function(t){return Object(g.jsx)(D,Object(d.a)(Object(d.a)({country:O},t),{},{disabled:!Boolean(O)||e.isSubmitting}))}}))]}),c(t)]},n);default:return Object(g.jsxs)("div",{children:["Not implemented field ",t.type]},n)}}))}),e.isSubmitting&&Object(g.jsx)("h3",{children:"Loading..."}),a(e)]})}})},V=function(e){var t,n,r,i=e.formData,s=e.onSubmit,u=Object(c.useState)(),l=Object(O.a)(u,2),o=l[0],d=l[1],b=Object(c.useState)(!1),j=Object(O.a)(b,2),f=j[0],m=j[1];return Object(g.jsxs)(g.Fragment,{children:[o&&Array.isArray(o)&&Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("table",{style:{border:"solid",borderCollapse:"collapse",marginBottom:20},width:"100%",children:[Object(g.jsx)("thead",{children:Object(g.jsx)("tr",{children:null===(t=i.find((function(e){return e.name===a.product})))||void 0===t?void 0:t.fields.map((function(e){return Object(g.jsx)("th",{style:{border:"solid"},children:e.label},e.id)}))})}),Object(g.jsx)("tbody",{children:o.map((function(e,t){return Object(g.jsx)("tr",{children:Object.values(e).map((function(e,t){var n;if("object"===typeof e)if("name"in e)n=e.name;else if(Array.isArray(e))n=e.join(", ");else{var r;n=Object(g.jsxs)("div",{style:{textAlign:"center"},children:[Object(g.jsx)("img",{width:32,src:null===e||void 0===e||null===(r=e.image)||void 0===r?void 0:r.src,alt:""}),Object(g.jsx)("div",{children:e.title})]})}else n=e;return Object(g.jsx)("td",{style:{border:"solid"},children:n},t)}))},t)}))})]}),f&&Object(g.jsx)("button",{onClick:function(){m(!1)},children:"ADD NEW PRODUCT"}),!f&&Object(g.jsx)("button",{onClick:function(){m(!0)},children:"CANCEL"})]}),!f&&Object(g.jsx)(T,{fields:null===(n=i.find((function(e){return e.name===a.product})))||void 0===n?void 0:n.fields,handleSubmit:function(e){d((function(t){return t&&Array.isArray(t)?[].concat(Object(p.a)(t),[e]):[e]})),m(!0)},children:function(e){return Object(g.jsx)("button",{disabled:e.isSubmitting,type:"submit",children:"Register"})}}),f&&o&&Array.isArray(o)&&Object(g.jsx)(T,{fields:null===(r=i.find((function(e){return e.name===a.customer})))||void 0===r?void 0:r.fields,handleSubmit:function(e){return s(e,o)},children:function(e){return Object(g.jsx)("button",{disabled:e.isSubmitting,type:"submit",children:"Register"})}})]})},R=function(e){var t=e.formData,n=e.onSubmit;return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(T,{fields:t.find((function(e){return e.name===a.all})).fields,handleSubmit:n,children:function(e){return Object(g.jsx)("button",{disabled:e.isSubmitting,type:"submit",children:"Register"})}})})};function M(e,t){return U.apply(this,arguments)}function U(){return(U=Object(m.a)(f.a.mark((function e(t,n){var r,a,c,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(e){return new Promise((function(t,n){t(e.name)}))},r={customer:{},sendEmails:!0,items:[]},c=function(){var e=Object(m.a)(f.a.mark((function e(t){var n,r,c,i,s,u,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.productName,r=t.serialNumber,t.state,c=Object(b.a)(t,["productName","serialNumber","state"]),i=n.image,s=Object(b.a)(n,["image"]),u=Object.keys(c).filter((function(e){return!!c[e]&&!!c[e].name})),e.next=5,Promise.all(u.map((function(e){return a(c[e])})));case 5:return l=e.sent,e.abrupt("return",Object(d.a)(Object(d.a)({},c),{},{product:Object(d.a)({imageUrl:null===i||void 0===i?void 0:i.src},s),serialNumbers:r,purchaseDate:(new Date).toISOString()},u.reduce((function(e,t,n){return e[t]=l[n],e}),{})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=function(e){var t=e.state,n=Object(b.a)(e,["state"]);return Object(d.a)(Object(d.a)({},n),{},{state:"object"===typeof t?t.label:t})},n){e.next=13;break}return s=["name","firstName","surname","dob","email","address1","address2","city","country","state","postCode","phone"].reduce((function(e,n){return e[n]=t[n],delete t[n],e}),{}),r.customer=i(s),e.next=9,c(t);case 9:e.t0=e.sent,r.items=[e.t0],e.next=17;break;case 13:return r.customer=i(t),e.next=16,Promise.all(n.map(c));case 16:r.items=e.sent;case 17:return e.abrupt("return",fetch("https://ensdmrncariaqkb.m.pipedream.net",{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(r)}).then((function(e){return e.json()})));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J=function(){var e=function(){var e,t=Object(c.useState)(),n=Object(O.a)(t,2),r=n[0],a=n[1],i=Object(c.useState)(),s=Object(O.a)(i,2),u=s[0],l=s[1],o=Object(c.useState)(!1),d=Object(O.a)(o,2),b=d[0],j=d[1],p=new URLSearchParams(document.location.search.substring(1)),h="form".concat(null!==(e=p.get("step"))&&void 0!==e?e:2,".json"),v=Object(c.useCallback)(Object(m.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),e.prev=1,e.next=4,fetch(h);case 4:return t=e.sent,e.next=7,t.json();case 7:n=e.sent,a(n),l(null),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),a(null),l(e.t0);case 16:return e.prev=16,j(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[1,12,16,19]])}))),[h]);return Object(c.useEffect)((function(){v()}),[v]),{formData:r,error:u,loading:b}}(),t=e.formData,n=e.loading,r=e.error,i=Object(c.useState)(!1),s=Object(O.a)(i,2),u=s[0],l=s[1],d=Object(c.useState)(null),b=Object(O.a)(d,2),j=b[0],p=b[1],h=Object(c.useState)(null),v=Object(O.a)(h,2),x=v[0],y=v[1];Object(c.useEffect)((function(){j&&setTimeout((function(){window.location.href=j}),5e3)}),[j]),Object(c.useEffect)((function(){document.body.style.overflow=u?"hidden":"unset"}),[u]);var S=Object(c.useCallback)(function(){var e=Object(m.a)(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M(t,n);case 3:if(!(r=e.sent).success){e.next=8;break}return l(!0),r.redirect&&p(r.redirect),e.abrupt("return",r);case 8:if(!r.error){e.next=11;break}return y(r.error),e.abrupt("return",r);case 11:e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error("error submitting data >>",e.t0),l(!0),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),[]);if(n)return Object(g.jsx)("div",{children:"Loading..."});if(r)return Object(g.jsx)("div",{children:"Error..."});var w=t?t.some((function(e){return e.name===a.all}))?Object(g.jsx)(R,{formData:t,onSubmit:S}):Object(g.jsx)(V,{formData:t,onSubmit:S}):null;return Object(g.jsxs)(g.Fragment,{children:[w,x&&Object(g.jsx)("h3",{style:{color:"red"},children:x}),Object(g.jsxs)(o.a,{isOpen:u,children:[Object(g.jsx)("h1",{children:"Thanks, registration finished!"}),Object(g.jsx)("button",{onClick:function(){j?window.location.href=j:l(!1)},children:"Ok"})]})]})},K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,322)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};o.a.setAppElement("#root"),u.a.render(Object(g.jsx)(i.a.StrictMode,{children:Object(g.jsx)(J,{})}),document.getElementById("root")),K()}},[[315,1,2]]]);
//# sourceMappingURL=main.c45e0115.chunk.js.map